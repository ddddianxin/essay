webpackJsonp([21],{QW0L:function(e,r){},ztEM:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("CCn6"),n=t("NYxO"),o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e};function a(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function s(n,o){try{var a=r[n](o),i=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(i).then(function(e){s("next",e)},function(e){s("throw",e)});e(i)}("next")})}}var i={name:"mOrderConfirm",data:function(){return{form:{goodsId:"",speId:"",number:"",type:0,needInvoice:!1,distribution:"normal"},invoiceType:"1",goods:{},orderDetail:{},address:"",personForm:{invoice_id:"",titleP:"",addressP:"",phoneP:""},companyForm:{invoice_id:"",ename:"",taxnumber:"",address:"",phone:"",bank:"",banknumber:""},personRules:{titleP:[{required:!0,message:"请输入名称",trigger:"blur"}],addressP:[{required:!0,message:"请填写地址",trigger:"blur"}],phoneP:[{required:!0,message:"请输入手机号",trigger:"blur"}]},companyRules:{ename:[{required:!0,message:"请输入公司名称",trigger:"blur"}],taxnumber:[{required:!0,message:"请输入公司税号",trigger:"blur"}],address:[{required:!0,message:"请填写开票地址",trigger:"blur"}],phone:[{required:!0,message:"请输入电话号码",trigger:"blur"}],bank:[{required:!0,message:"请输入开户银行",trigger:"blur"}],banknumber:[{required:!0,message:"请输入银行账号",trigger:"blur"}]}}},components:{},mounted:function(){this.getUserInfo(),this.initData()},computed:o({},Object(n.d)(["userInfo","addressId"])),methods:o({},Object(n.b)(["getUserInfo"]),Object(n.c)(["CHOOSE_ADDRESS"]),{initData:function(){var e=this;return a(regeneratorRuntime.mark(function r(){var t,n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e.form.goodsId=e.$route.query.goodsId||"",e.form.speId=e.$route.query.speId||"",e.form.number=e.$route.query.number||0,e.form.type=e.$route.query.type?1:0,!e.userInfo||!e.userInfo.user_id){r.next=15;break}return r.next=7,Object(s.k)(e.form.speId,e.form.number);case 7:return t=r.sent,e.orderDetail=t,e.goods=t.goodsInfo,e.initAddress(),r.next=13,Object(s.F)();case 13:for(n=r.sent,o=0;o<n.length;o++)0==n[o].type?e.companyForm=n[o]:e.personForm={invoice_id:n[o].invoice_id,titleP:n[o].title,addressP:n[o].address,phoneP:n[o].phone};case 15:case"end":return r.stop()}},r,e)}))()},initAddress:function(){var e=this;return a(regeneratorRuntime.mark(function r(){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.userInfo||!e.userInfo.user_id){r.next=5;break}return r.next=3,Object(s.f)();case 3:if(t=r.sent,e.addressId)for(n=0;n<t.length;n++)t[n].add_id==e.addressId&&(e.address=t[n]);else for(n=0;n<t.length;n++)1==t[n].is_default&&(e.address=t[n]);case 5:case"end":return r.stop()}},r,e)}))()},submitInvoiceForm:function(e,r){var t,n=this;r=r||"",this.$refs[e].validate((t=a(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=18;break}if("0"!=n.invoiceType){e.next=7;break}return e.next=4,Object(s.d)(r,"",n.invoiceType,n.companyForm.taxnumber,n.companyForm.address,n.companyForm.banknumber,n.companyForm.phone,n.companyForm.bank,n.companyForm.ename);case 4:o=e.sent,e.next=10;break;case 7:return e.next=9,Object(s.d)(r,n.personForm.titleP,n.invoiceType,"",n.personForm.addressP,"",n.personForm.phoneP,"","");case 9:o=e.sent;case 10:if(!o){e.next=16;break}if(n.$message({message:o.msg,type:12e3==o.status?"success":"warning"}),12e3!=o.status){e.next=16;break}return e.next=15,Object(s.F)();case 15:e.sent;case 16:e.next=19;break;case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}},e,n)})),function(e){return t.apply(this,arguments)}))},createOrder:function(){var e=this;return a(regeneratorRuntime.mark(function r(){var t,n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t="","normal"==e.form.distribution&&(t=e.address.add_id?e.address.add_id:""),0!=e.form.type){r.next=22;break}return r.next=5,Object(s.O)("normal"==e.form.distribution?1:0,t,0==e.form.needInvoice?"":"0"==e.invoiceType?e.companyForm.invoice_id:e.personForm.invoice_id,0==e.form.needInvoice?0:1);case 5:if(!(n=r.sent)){r.next=20;break}if(12e3!=n.status){r.next=19;break}if("micromessenger"!=window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)){r.next=16;break}return r.next=12,Object(s.z)("");case 12:o=r.sent,window.location.href=o.url,r.next=17;break;case 16:e.$router.push({path:"/order/pay",query:{orderId:""}});case 17:r.next=20;break;case 19:e.$message({message:n.msg,type:"warning"});case 20:r.next=39;break;case 22:return r.next=24,Object(s.P)("normal"==e.form.distribution?1:0,t,0==e.form.needInvoice?"":"0"==e.invoiceType?e.companyForm.invoice_id:e.personForm.invoice_id,0==e.form.needInvoice?0:1,e.form.speId?e.form.speId:"",e.form.goodsId?e.form.goodsId:"",e.form.number?e.form.number:"");case 24:if(!(n=r.sent)){r.next=39;break}if(12e3!=n.status){r.next=38;break}if("micromessenger"!=window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)){r.next=35;break}return r.next=31,Object(s.z)(n.orderId);case 31:o=r.sent,window.location.href=o.url,r.next=36;break;case 35:e.$router.push({path:"/order/pay",query:{orderId:n.orderId}});case 36:r.next=39;break;case 38:e.$message({message:n.msg,type:"warning"});case 39:case"end":return r.stop()}},r,e)}))()},checkForm:function(){var e,r,t=this;1==this.form.needInvoice?1==this.invoiceType?this.$refs.personForm.validate((r=a(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}t.submitInvoiceForm("personForm",t.personForm.invoice_id),t.createOrder(),e.next=6;break;case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,t)})),function(e){return r.apply(this,arguments)})):this.$refs.companyForm.validate((e=a(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}t.submitInvoiceForm("companyForm",t.companyForm.invoice_id),t.createOrder(),e.next=6;break;case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,t)})),function(r){return e.apply(this,arguments)})):this.createOrder()},toSelAddress:function(){this.$router.push({path:"/order/address",query:{goodsId:this.form.goodsId,speId:this.form.speId,number:this.form.number,type:this.form.type}})}}),created:function(){},watch:{userInfo:function(){this.initData()}}},c={render:function(){var e=this,r=e.$createElement,s=e._self._c||r;return s("div",[s("div",{attrs:{id:"mHead"}},[s("div",{staticClass:"mH-nav"},[s("div",{on:{click:function(r){return e.$router.back(-1)}}},[s("i",{staticClass:"el-icon-arrow-left icon"})]),e._v(" "),s("router-link",{attrs:{to:"/home"}},[s("div",{staticClass:"logo"},[s("img",{staticClass:"logo",attrs:{src:t("bPD/")}})])]),e._v(" "),s("router-link",{attrs:{to:"/home"}},[s("i",{staticClass:"el-icon-s-home icon"})])],1)]),e._v(" "),s("div",{staticClass:"mBg"},[s("div",{staticClass:"m-o-selAdd"},[s("h1",{staticClass:"w mb5"},[e._v("选择快递方式")]),e._v(" "),s("div",{staticClass:"w"},[s("el-radio-group",{attrs:{size:"small"},model:{value:e.form.distribution,callback:function(r){e.$set(e.form,"distribution",r)},expression:"form.distribution"}},[s("el-radio",{attrs:{label:"normal",border:""}},[e._v("普通物流")]),e._v(" "),s("el-radio",{attrs:{label:"self",border:""}},[e._v("自提")])],1)],1)]),e._v(" "),"normal"==e.form.distribution?s("div",[s("div",{staticClass:"addBorder"}),e._v(" "),s("div",{on:{click:function(r){return e.toSelAddress()}}},[0!=e.address.length?s("div",{staticClass:"m-o-address"},[s("div",{staticClass:"mo-a-name"},[s("div",[e._v(e._s(e.address.name))]),e._v(" "),e.address.is_default?s("span",[e._v("默认")]):e._e()]),e._v(" "),s("div",{staticClass:"mo-a-info"},[s("div",{staticClass:"mo-a-phone"},[e._v(e._s(e.address.phone))]),e._v(" "),s("div",{staticClass:"mo-a-address wto"},[e._v(e._s(e.address.address))])]),e._v(" "),e._m(0)]):s("div",{staticClass:"m-o-address"},[s("div",[e._v("您还未选择任何收货地址")]),e._v(" "),s("i",{staticClass:"el-icon-arrow-right iicon"})])])]):e._e(),e._v(" "),s("div",{staticClass:"m-o-invoice"},[s("div",{staticClass:"mo-c-line"},[s("div",{staticClass:"mc-lf"},[e._v("\n                       我要开发票\n                    ")]),e._v(" "),s("div",{staticClass:"mc-rg"},[s("el-switch",{model:{value:e.form.needInvoice,callback:function(r){e.$set(e.form,"needInvoice",r)},expression:"form.needInvoice"}})],1)])]),e._v(" "),e.form.needInvoice?s("div",{staticClass:"m-o-inBox"},[s("div",{staticClass:"m_sel flex f-nowrap"},[s("div",{staticClass:"m_tit"},[e._v("选择类型：")]),e._v(" "),s("div",{staticClass:"m_choice pb10"},[s("el-radio-group",{attrs:{size:"small"},model:{value:e.invoiceType,callback:function(r){e.invoiceType=r},expression:"invoiceType"}},[s("el-radio",{attrs:{label:"1",border:""}},[e._v("个人")]),e._v(" "),s("el-radio",{attrs:{label:"0",border:""}},[e._v("企业")])],1)],1)]),e._v(" "),"1"==e.invoiceType?s("div",{staticClass:"pb15"},[s("el-form",{ref:"personForm",attrs:{model:e.personForm,rules:e.personRules,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"名称",prop:"titleP"}},[s("el-input",{model:{value:e.personForm.titleP,callback:function(r){e.$set(e.personForm,"titleP",r)},expression:"personForm.titleP"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"地址",prop:"addressP"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.personForm.addressP,callback:function(r){e.$set(e.personForm,"addressP",r)},expression:"personForm.addressP"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话号码",prop:"phoneP"}},[s("el-input",{model:{value:e.personForm.phoneP,callback:function(r){e.$set(e.personForm,"phoneP",r)},expression:"personForm.phoneP"}})],1)],1)],1):s("div",{staticClass:"pb15"},[s("el-form",{ref:"companyForm",attrs:{model:e.companyForm,rules:e.companyRules,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"公司名称",prop:"ename"}},[s("el-input",{model:{value:e.companyForm.ename,callback:function(r){e.$set(e.companyForm,"ename",r)},expression:"companyForm.ename"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"公司税号",prop:"taxnumber"}},[s("el-input",{model:{value:e.companyForm.taxnumber,callback:function(r){e.$set(e.companyForm,"taxnumber",r)},expression:"companyForm.taxnumber"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开票地址",prop:"address"}},[s("el-input",{attrs:{type:"textarea"},model:{value:e.companyForm.address,callback:function(r){e.$set(e.companyForm,"address",r)},expression:"companyForm.address"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话号码",prop:"phone"}},[s("el-input",{model:{value:e.companyForm.phone,callback:function(r){e.$set(e.companyForm,"phone",r)},expression:"companyForm.phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开户银行",prop:"bank"}},[s("el-input",{model:{value:e.companyForm.bank,callback:function(r){e.$set(e.companyForm,"bank",r)},expression:"companyForm.bank"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"银行账号",prop:"banknumber"}},[s("el-input",{model:{value:e.companyForm.banknumber,callback:function(r){e.$set(e.companyForm,"banknumber",r)},expression:"companyForm.banknumber"}})],1)],1)],1)]):e._e(),e._v(" "),s("div",{staticClass:"m-o-pro"},[s("h1",{staticClass:"m-o-h1"},[e._v("商品信息")]),e._v(" "),e._l(e.goods,function(r,t){return s("div",{key:t,staticClass:"m-d-item"},[s("div",{staticClass:"m-d-pic"},[s("el-image",{staticClass:"md-image",attrs:{src:r.pic,fit:"cover"}})],1),e._v(" "),s("div",{staticClass:"m-d-info"},[s("div",{staticClass:"m-d-name"},[e._v(e._s(r.name))]),e._v(" "),s("div",{staticClass:"m-d-spec"},[s("span",[e._v("规格："+e._s(r.spec_name)+e._s(r.spec_unit))])]),e._v(" "),s("div",{staticClass:"m-d-price"},[s("div",{staticClass:"md-price"},[e._v("￥"+e._s(r.price)+"/"+e._s(r.supply_unit))]),e._v(" "),s("div",{staticClass:"md-number"},[e._v("\n                                ×"+e._s(r.number)+"\n                            ")])])])])})],2)]),e._v(" "),s("div",{staticClass:"m-o-foot"},[s("div",{staticClass:"m-o-pay"},[e._v("应付：￥"+e._s(e.orderDetail.checkedGoodsAmount))]),e._v(" "),s("div",{staticClass:"m-o-btn",on:{click:function(r){return e.checkForm()}}},[s("span",[e._v("去付款")])])])])},staticRenderFns:[function(){var e=this.$createElement,r=this._self._c||e;return r("div",{staticClass:"mo-a-arrow"},[r("i",{staticClass:"el-icon-arrow-right icon"})])}]};var m=t("VU/8")(i,c,!1,function(e){t("QW0L")},null,null);r.default=m.exports}});
//# sourceMappingURL=21.feb9cef9bac2a00ab595.js.map